<!DOCTYPE html>
 <html>
   <head>
<meta charset="utf‐8">
<title> Hello web audio </title> </head>

<body>
  <button id="start">Start</button>
</body>

   <script>
function playSound(buffer, time) {
  var source = context.createBufferSource();
  source.buffer = buffer;
  source.connect(context.destination);
  source.start(time);
}

    function playSound(buffer, time, context){
      const source = context.createBufferSource();
      source.buffer = buffer
      source.connect(context.destination);
      source.start(time);
    }

    const startLoop = (() => {
      let context = null;
      return async url => {
        if (context) context.close();
        context = new AudioContext();
    
        var buffer = await fetch(url)
          .then(res => res.arrayBuffer())
          .then(arrayBuffer => context.decodeAudioData(arrayBuffer));

        var startTime = context.currentTime;
        var tempo = 120; // BPM (beats per minute)
        var eighthNoteTime = (60 / tempo);
        
        for (var bar = 0; bar < 5000; bar++) {
          var time = startTime + bar;
          playSound(buffer, time + 4 * eighthNoteTime, context);
        }

      };
    })();
    
    document.querySelector('#start').onclick = () => startLoop('./beat.wav');


   </script>
</html>
