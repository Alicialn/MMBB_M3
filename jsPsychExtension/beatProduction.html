<!DOCTYPE html>
<html>
<body>

<button onclick="start(250, [1, 0, 1, 0])">Half on beat</button>
<button onclick="start(250, [0, 1, 0, 1])">Half counter beat</button>
<button onclick="stop()">Stop beat</button>

<div class="slidecontainer">
  <input type="range" min="-2" max="2" value="0" class="slider" id="myRange">
  <div id="show"></div>
</div>

<div id="0" style='background-color:red'>1/4</div>
<div id="1" style='background-color:red'>1/4</div>
<div id="2" style='background-color:red'>1/4</div>
<div id="3" style='background-color:red'>1/4</div>

</body>

<script>

var audio = new Audio('./beat.wav');

function audioPlayer(){
  audio.pause()
  audio.currentTime = 0
  audio.play()
}

var barRun;
var barLoop;

const barMaker = (bpm, beatStructure)=>{
  for (let i = 0; i <= 3; i++) {
      barRun = setTimeout( () =>{
        console.log(beatStructure[i])

        if(beatStructure[i] === 1){
            audioPlayer()
            document.getElementById("0").style.backgroundColor = 'red'
            document.getElementById("1").style.backgroundColor = 'red'
            document.getElementById("2").style.backgroundColor = 'red'
            document.getElementById("3").style.backgroundColor = 'red'
            document.getElementById(i).style.backgroundColor = 'gray'
        }
      }, i * bpm)
    }
}

function stop(){
  clearInterval(barLoop)
  clearTimeout(barRun)
}


function start(bpm, beatStructure){
  clearInterval(barLoop)
  clearTimeout(barRun)
  barRun = barMaker(bpm, beatStructure)
  barLoop = setInterval( function(){barMaker(bpm, beatStructure)}, bpm*4)
}

function arrayRotate(arr, count) {
  count -= arr.length * Math.floor(count / arr.length);
  arr.push.apply(arr, arr.splice(0, count));
  return arr;
}

var slide = document.getElementById("myRange")
slide.addEventListener('input', function(){
    beatStructure = [0, 1, 0, 1]
    newBeatStructure = arrayRotate(beatStructure, this.value)
    console.log(
        newBeatStructure
    )
    document.getElementById('shifter').innerHTML = newBeatStructure
  }
);


</script>

</html>





