<html>

<h1>Latency</h1>

Turn the volume loud enough that the mic can hear the speaker.  When ready, press start.
<p>
<button id="startButton">Start</button>
<div id="showLatency"></div>

<script>

async function start() {
  document.removeEventListener("click", start);

  var audioCtx = new (window.AudioContext || window.webkitAudioContext)({
    latencyHint: 0,
  });
  var micStream = await navigator.mediaDevices.getUserMedia({
    audio: {
      latency: 0,
      echoCancellation: false,
      noiseSuppression: false,
      autoGainControl: false,
    }
  });
  var micNode = new MediaStreamAudioSourceNode(audioCtx, { mediaStream: micStream });
  await audioCtx.audioWorklet.addModule('./latencyMeasurer.js');
  var playerNode = new AudioWorkletNode(audioCtx, 'player');
  micNode.connect(playerNode)
  playerNode.connect(audioCtx.destination);
}

document.getElementById("startButton").addEventListener("click", start);

</script>
</html>
