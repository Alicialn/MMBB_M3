<html>

<h1>Latency</h1>

Press start to measure the latency of audio. If you are wearing headphones or earplugs, position the speakers right in front of your phone/computer's microphone.
Find a quiet place, and turn up your device volume as much as possible. 

<p>
<button id="startButton">Start</button>
<div id="showLatency"></div>

<script>

async function start() {
  document.removeEventListener("click", start);

  var audioCtx = new (window.AudioContext || window.webkitAudioContext)({
    latencyHint: 0,
  });

  var micStream = await navigator.mediaDevices.getUserMedia({
    audio: {
      latency: 0,
      echoCancellation: false,
      noiseSuppression: false,
      autoGainControl: false,
    }
  });

  var micNode = new MediaStreamAudioSourceNode(audioCtx, { mediaStream: micStream });
  await audioCtx.audioWorklet.addModule('./latencyMeasurer.js');
  var playerNode = new AudioWorkletNode(audioCtx, 'player');
  micNode.connect(playerNode)
  playerNode.connect(audioCtx.destination);

}

document.getElementById("startButton").addEventListener("click", start);

</script>
</html>
