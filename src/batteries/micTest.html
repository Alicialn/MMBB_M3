<html>
<h1>Latency Demo</h1>

<i><span id=recording></span></i>

<script>

var audioCtx;
var micStream;
var micNode;

async function start() {
  document.removeEventListener("keydown", start);

  audioCtx = new (window.AudioContext || window.webkitAudioContext)({
    latencyHint: 0,
  });
  micStream = await navigator.mediaDevices.getUserMedia({
    audio: { latency: 0, echoCancellation: false, noiseSuppression: false, autoGainControl: false }
  });
  micNode = new MediaStreamAudioSourceNode(audioCtx, { mediaStream: micStream });
  await audioCtx.audioWorklet.addModule('pitchDetect.js');
  var analyzerNode = new AudioWorkletNode(audioCtx, 'pitchDetect');
  micNode.connect(analyzerNode)
  console.log(micNode)
}

// We can only start recording on user action, so ask them to press a
// key to start.
document.addEventListener("keydown", start);
</script>
</html>
