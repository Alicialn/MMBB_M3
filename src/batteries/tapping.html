<!DOCTYPE html>
<html>
  <head>
    <title>MMBB batery</title>
    <script src="../../jspsych/dist/custom/utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../jspsych/dist/graphFunction.js"> </script>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.0"></script>
    <script src="../../jspsych/dist/plugin-audio-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-songselector-response.js"> </script>
    <script src="../../jspsych/dist/plugin-instructions.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-likert.js"> </script>
    <script src="../../jspsych/dist/plugin-canvas-button-response.js"> </script>
    <script src="../../jspsych/dist/extension-accelerometer.js"> </script>
    <script src="../../jspsych/dist/plugin-html-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-multi-choice.js"> </script>
    <script src="../../jspsych/dist/plugin-initialize-microphone.js"> </script>
    <script src="../../jspsych/dist/plugin-preload.js"> </script>
    <script src="../../jspsych/dist/plugin-html-audio-response.js"></script>
    <script src="../../songs/movementTapAudio/songKeysNames.js"></script>
    <script src="../../jspsych/dist/custom/utils.js"></script>
    <script src="./translations.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css">
    <link href="./generalCSS.css" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  </head>
  <body></body>
  <style>

  </style>
  <script>

    var jsPsych = initJsPsych({
      on_finish: function() {
        //jsPsych.data.displayData();
        jsPsych.data.get().localSave('csv','mydata.csv');
      }
    });
    
    var lang = 'eng';

    var instruction0 = {
        type: jsPsychInstructions,
        pages: tapping[0].map(i=>i[lang]),
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
    }

    var instruction1 = {
        type: jsPsychInstructions,
        pages: tapping[1].map(i=>i[lang]),
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
    }

    var instruction2 = {
        type: jsPsychInstructions,
        pages: tapping[2].map(i=>i[lang]),
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
    }

    var instruction3 = {
        type: jsPsychInstructions,
        pages: tapping[3].map(i=>i[lang]),
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
    }

    function buttonDown(){
          document.getElementById("tappingButton").innerHTML = '<p id="customText">--</p>'
          sleep(10).then((r)=>{
            document.getElementById("tappingButton").innerHTML = '<p id="customText">Tap here</p>'
          })
    }


    //Determine if mobile or desktop
    var mobile = mobileAndTabletCheck() 
    if(mobile){
      var eventTypeStart = "ontouchstart"
      var eventTypeEnd = "ontouchend"
    } else {
      var eventTypeStart = "onmousedown"
      var eventTypeEnd = "onmouseup"
    }

    //Call random hemiola
    var randomHemioleIndex = random(0, songKeys['8'].length -1)
    var randomHemioleSong = songKeys['8'][randomHemioleIndex]
     
    var randomElPesebreIndex = random(0, songKeys['7'].length -1)
    var randomElPesebreSong = songKeys['7'][randomElPesebreIndex]

    var randomMetronome = random(0, songKeys['10'].length -1)
    var randomMetronome = songKeys['9'][randomMetronome]

    var songsToPreload = [randomElPesebreSong, randomHemioleSong, randomMetronome]
    var songPaths = '../../songs/movementTapAudio/modifiedAudio/'
    var pathsToPreload = songsToPreload.map(i=>songPaths+i)
    var preloadSongs = {
      type: jsPsychPreload,
      audio: pathsToPreload 
    }   
    console.log(randomElPesebreSong)
    console.log(randomHemioleSong)
    console.log(randomMetronome)

    var trialTapping0 = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: '../../songs/movementTapAudio/silence.wav',
        trial_duration: 10000,
        button_html: '<button type="button" ' + eventTypeStart + '="buttonDown()" id="tappingButton"><p id="customText" style="font-size:15vw; color: white;">' + tapping[4][0][lang] + '</p></button>',
        response_ends_trial: false,
    }

    var trialTapping1 = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: '../../songs/movementTapAudio/modifiedAudio/' + randomMetronome,
        trial_duration: 10000,
        button_html: '<button type="button" ' + eventTypeStart + '="buttonDown()" id="tappingButton"><p id="customText" style="font-size:15vw; color: white;">' + tapping[4][0][lang] + '</p></button>',
        response_ends_trial: false,
    }
        
    var trialTapping2 = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: '../../songs/movementTapAudio/modifiedAudio/' + randomHemioleSong,
        trial_duration: 10000,
        button_html: '<button type="button" ' + eventTypeStart + '="buttonDown()" id="tappingButton"><p id="customText" style="font-size:15vw; color: white;">' + tapping[4][0][lang] + '</p></button>',
        response_ends_trial: false,
    }
    
    var trialTapping3 = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: '../../songs/movementTapAudio/modifiedAudio/' + randomElPesebreSong,
        trial_duration: 10000,
        button_html: '<button type="button" ' + eventTypeStart + '="buttonDown()" id="tappingButton"><p id="customText" style="font-size:15vw; color: white;">' + tapping[4][0][lang] + '</p></button>',
        response_ends_trial: false,
    }

    var messageEndTask = {
      type: jsPsychHtmlButtonResponse,
      prompt: recurring[3][lang],
      choices: [],
      trial_duration: 3000,
      stimulus: '',
    };

    jsPsych.run([preloadSongs, instruction0, trialTapping0, messageEndTask, instruction1, trialTapping1, messageEndTask, instruction2, trialTapping2, messageEndTask, instruction3, trialTapping3, messageEndTask]);

 </script>
</html>
