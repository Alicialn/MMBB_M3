<!DOCTYPE html>
<html>
  <head>
    <title>MMBB batery</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../jspsych/dist/graphFunction.js"> </script>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.0"></script>
    <script src="../../jspsych/dist/plugin-audio-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-html-form.js"> </script>
    <script src="../../jspsych/dist/plugin-image-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-instructions.js"> </script>
    <script src="../../jspsych/dist/plugin-free-sort.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-likert.js"> </script>
    <script src="../../jspsych/dist/plugin-canvas-button-response.js"> </script>
    <script src="../../jspsych/dist/extension-accelerometer.js"> </script>
    <script src="../../jspsych/dist/plugin-html-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-multi-choice.js"> </script>
    <script src="../../jspsych/dist/plugin-initialize-microphone.js"> </script>
    <script src="../../jspsych/dist/plugin-html-audio-response.js"> </script>
    <link href="../../jspsych/dist/jspsych.css" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      extensions: [
        {type: jsPsychExtensionAccelerometer }
      ],
      on_finish: function() {
        //jsPsych.data.displayData();
        jsPsych.data.get().localSave('csv','mydata.csv');
      }
    });
    
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const diadNumber = urlParams.get('diad')
    console.log(diadNumber)
  
    var participantID = {
      type: jsPsychSurveyHtmlForm,
      preamble: '<p style="font-size:7vw">Participant ID</p>',
      html: '<p><input type="text" id="test-resp-box" name="response" size="10" /></p>',
      autofocus: 'test-resp-box'
    };

    var instruction1 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:7vw;">When you click start, you will see some questions.</p>',
        '<p style="font-size:7vw;">Your task is to answer them.</p>'
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    const sorting_stimuli = ['./img/survey/a.001.png', './img/survey/a.002.png']

    var howFeeling = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                    <p style="font-size:3vw;">How do you feel?</p>
                   </div>`,
        require_movement: true,
        labels: ['<p style="font-size:3vw">Really bad</p>', '<p style="font-size:3vw">Excellent</p>']
    };

    var howFeeling2 = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "<p style='font-size:3vw'>How do you feel now compared to your last rating?</p>",
      choices: ['Worse', 'Same', 'Better'],
      prompt: ""
    };
    
    var trialSurvey = {
      type: jsPsychSurveyMultiChoice,
      questions: [{
          prompt: '<p style="font-size:7vw;">Implement questionnaire here</p>',
          options: ['Option 1', 'Option 2', 'Option 3'], 
          required: false
        }]
    };
 
    var options = [
      "Strongly Disagree", 
      "Disagree", 
      "Neutral", 
      "Agree", 
      "Strongly Agree"
    ];

    var instructionPreCloseness = {
      type: jsPsychInstructions,
      pages: [
      '<p style="font-size:7vw;">In the next page, use the slider to indicate how close you feel to your pair</p>',
      ],
      button_label_next: "Next",
      button_label_previous: "Previous",
      show_clickable_nav: true
    }

    var closeness1 = {
      type: jsPsychImageSliderResponse,
      stimulus: ['../emotion_demo/basic_emoji/v5a1.png', '../emotion_demo/basic_emoji/v5a1.png'],
      stimulus_width: 200,
      min: 0,
      slider_start: 0,
      step: 1,
      max: 490,
      maintain_aspect_ration: true,
    };

    var closeness2 = {
      type: jsPsychImageSliderResponse,
      stimulus: ['../emotion_demo/basic_emoji/v5a1.png', '../emotion_demo/basic_emoji/v5a1.png'],
      stimulus_width: 200,
      min: 0,
      slider_start: 500,
      step: 1,
      max: 490,
      maintain_aspect_ration: true,
      on_start: function(trial) {
        var allData = jsPsych.data.get().values()
        console.log(allData.length - 2)
        console.log(allData)
        var startPoint = allData[allData.length - 4]['response']
        trial.slider_start = startPoint
        trial.start_separation = startPoint
      }
    };

    var inter = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:7vw;">Please, hand the ipad back to the experimenter</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    var likeSong = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
            <p style="font-size:3vw;">How much do you like the song that you just heard?</p>
            </div>`,
        require_movement: true,
        labels: ['<p style="font-size:3vw">Not at all</p>', '<p style="font-size:3vw">Very much</p>']
    };

    var familiaritySong = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
            <p style="font-size:3vw;">How familiar were you with the song that you just heard?</p>
            </div>`,
        require_movement: true,
        labels: ['<p style="font-size:3vw">Never heard it before</p>', '<p style="font-size:3vw">Know it very well</p>']
    };
    
    //Determining which timeline to run
    if(diadNumber == 1){
      var timelineChosen = [participantID, 
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, trialSurvey, howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, inter]
    }
    if(diadNumber == 2){
      var timelineChosen = [participantID, 
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, inter,
                            howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, trialSurvey, howFeeling2, instructionPreCloseness, closeness2,
                            howFeeling2, instructionPreCloseness, closeness2, inter]
    }

    jsPsych.run(timelineChosen);
    //jsPsych.run([instruction1, closeness, trialLikert, trialSurvey]);

 </script>
</html>
